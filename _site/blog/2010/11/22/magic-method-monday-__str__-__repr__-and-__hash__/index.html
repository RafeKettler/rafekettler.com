


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    
  <title>rafekettler.com</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
<link rel="alternate" type="application/atom+xml" title="Atom 1.0"
href="/blog/feed/atom" />
<link rel='stylesheet' href='/css/pygments_tango.css' type='text/css' />
<link rel='stylesheet' href='/css/site.css' type='text/css' />


  </head>
  <body>
    <div id="content">
      
  <h1><a href="/">rafekettler.com</a></h1>
<h3>My thoughts on programming and technology</h3>
<nav>
<ul>
<li><a href="/blog">Blog</a></li>
<li><a href="/about.html">About me</a></li>
<li><a href="/magicmethods.html">Magic Methods Guide</a></li>
</ul>
</nav>
<hr/>


      <div id="main_block">
        <div id="prose_block">
          

<div class="blog_post">
  <a name="magic-method-monday-__str__-__repr__-and-__hash__"></a>
  <h2 class="blog_post_title"><a href="/blog/2010/11/22/magic-method-monday-__str__-__repr__-and-__hash__" rel="bookmark" title="Permanent Link to Magic Method Monday: __str__, __repr__, and __hash__">Magic Method Monday: __str__, __repr__, and __hash__</a></h2>
  <p><small>11.22.2010 at 05:30 PM in 

<a href='/blog/category/python'>Python</a>, <a href='/blog/category/magic-method-monday'>Magic Method Monday</a>
 | <a href="http://www.rafekettler.com/blog/2010/11/22/magic-method-monday-__str__-__repr__-and-__hash__#disqus_thread">View Comments</a>
</small></p>
  <div class="post_prose">
    
  <p>One of the best parts about Python's magic methods is that they allow you to control exactly how built-in functions operate on custom objects. Today, we'll look at how to define custom behavior for the <code>str()</code>, <code>repr()</code>, and <code>hash()</code>. These functions are important parts of basic Python.</p>
<p><strong>str(), repr(), and hash()</strong></p>
<p>Very quickly, we'll look at what these functions do. str() returns a nicely printable version of an object, repr() returns a more detailed representation of an object, more suitable for debugging (that is always a valid Python expression), and hash() is able to return a hash value for certain data types (e.g. characters, strings, integers, floats). An example session with the interpreter:</p>
<div class="pygments_tango"><pre>&gt;&gt;&gt; str(&#39;a&#39;)
&#39;a&#39;
&gt;&gt;&gt; repr(&#39;a&#39;)
&quot;&#39;a&#39;&quot;
&gt;&gt;&gt; hash(&#39;a&#39;)
-468864544
</pre></div>

<p><code>__str__</code></p>
<p>Defines custom behavior when str() is called on an object. It takes the argument self and returns a string.</p>
<p><code>__repr__</code></p>
<p>Defines custom behavior when repr() is called on an object. It takes the argument self and returns a string. The returned value, if possible, should be a valid Python expression that could be used to reproduce the object.</p>
<p><code>__hash__</code></p>
<p>Defines how Python behaves when hash() is called on an object. This can be particularly useful for creating dictionaries and other mappings. It takes arguments self and returns an integer hash value. By default, the hash() function isn't particularly good, because it allows for collisions (<code>hash(1)</code> and <code>hash(1.0)</code> will return the same values).</p>
<p><strong>In action: a useful example, finally</strong></p>
<p>Usually when I give examples for Magic Method Monday, they're so abstract or silly as to be completely useless. But today, I've come up with an example class that actually might have some use: a hashable integer.</p>
<div class="pygments_tango"><pre><span class="k">class</span> <span class="nc">HashableInt</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="c"># An int with a non-colliding hash function   </span>
    <span class="n">hashvalue</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hashvalue</span> <span class="o">=</span> <span class="n">HashableInt</span><span class="o">.</span><span class="n">hashvalue</span>
        <span class="n">HashableInt</span><span class="o">.</span><span class="n">hashvalue</span> <span class="o">+=</span> <span class="mi">1</span>

<pre><code>&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__str__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Hashable int &lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt; with hash &lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hashvalue&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__repr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;lt;HashableInt &lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt; with hash &lt;/span&gt;&lt;span class="si"&gt;%i&lt;/span&gt;&lt;span class="s"&gt;&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hashvalue&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__hash__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hashvalue&lt;/span&gt;
</code></pre>
<p></pre></div></p>
<p>Here's how this would play out:</p>
<p>$$code(lang=pythonconsole)</p>
<blockquote>
<blockquote>
<blockquote>
<p>x = HashableInt(10)
str(x)
'Hashable int 10 with hash 0'
repr(x)
'<HashableInt 10 with hash 0>'
hash(x)
0
y = HashableInt(10)
hash(y)
1</p>
</blockquote>
</blockquote>
</blockquote>

  </div>
</div>



<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://www.rafekettler.com/blog/2010/11/22/magic-method-monday-__str__-__repr__-and-__hash__";
</script>
<script type="text/javascript" src="http://disqus.com/forums/rafekettler.com/embed.js"></script>
<noscript><a href="http://rafekettler.com.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

        </div><!-- End Prose Block -->
      </div><!-- End Main Block -->
      <div id="footer">
        
  <hr/>
  <p id="credits">
Copyright &copy; Rafe Kettler, 2010-11<br/>
Powered by <a href="http://www.blogofile.com">Blogofile</a>.<br/>
RSS feeds for <a href="/blog/feed">Entries</a>
 and <a
href="http://rafekettler.com.disqus.com/latest.rss">Comments</a>.
<br>
</p>
<script type="text/javascript">
//<![CDATA[
(function() {
		var links = document.getElementsByTagName('a');
		var query = '?';
		for(var i = 0; i < links.length; i++) {
			if(links[i].href.indexOf('#disqus_thread') >= 0) {
				query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
			}
		}
		document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/rafekettler.com/get_num_replies.js' + query + '"></' + 'script>');
	})();
//]]>
</script>


      </div> <!-- End Footer -->
    </div> <!-- End Content -->
  </body>
</html>



















