


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    
  <title>rafekettler.com</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
<link rel="alternate" type="application/atom+xml" title="Atom 1.0"
href="/blog/feed/atom" />
<link rel='stylesheet' href='/css/pygments_tango.css' type='text/css' />
<link rel='stylesheet' href='/css/site.css' type='text/css' />


  </head>
  <body>
    <div id="content">
      
  <h1><a href="/">rafekettler.com</a></h1>
<h3>My thoughts on programming and technology</h3>
<nav>
<ul>
<li><a href="/blog">Blog</a></li>
<li><a href="/about.html">About me</a></li>
<li><a href="/magicmethods.html">Magic Methods Guide</a></li>
</ul>
</nav>
<hr/>


      <div id="main_block">
        <div id="prose_block">
          

<div class="blog_post">
  <a name="magic-method-monday-creating-custom-sequences-and-mappings"></a>
  <h2 class="blog_post_title"><a href="/blog/2010/11/08/magic-method-monday-creating-custom-sequences-and-mappings" rel="bookmark" title="Permanent Link to Magic Method Monday: Creating Custom Sequences and Mappings">Magic Method Monday: Creating Custom Sequences and Mappings</a></h2>
  <p><small>11.08.2010 at 04:42 PM in 

<a href='/blog/category/python'>Python</a>, <a href='/blog/category/magic-method-monday'>Magic Method Monday</a>
 | <a href="http://www.rafekettler.com/blog/2010/11/08/magic-method-monday-creating-custom-sequences-and-mappings#disqus_thread">View Comments</a>
</small></p>
  <div class="post_prose">
    
  <p>In Python, the builtin types <code>list</code> and <code>dict</code> are so
powerful that it's hard to imagine when one would need more functionality.
However, custom functionality is needed all the time, and thankfully Python
provides an easy protocol through inheritance and magic methods to define custom
sequences and mappings, or container objects.</p>
<p><strong>What you need</strong></p>
<p>To create a custom immutable sequence, only <code>__len__</code> and
<code>__getitem__</code> must be defined. However, mutable types like the lists
and dictionaries we've come to love require one to also implement
<code>__setitem__</code> and <code>__delitem__</code>. In our example, we'll be
implementing all of them.</p>
<p><code>__len__</code></p>
<p>This magic method is relatively self explanatory. It returns the length of the
object, much like a call to <code>len(somelist)</code> or
<code>len(somedict)</code> would return the length of a sequence or mapping.It
takes the argument <code>self</code></p>
<p><code>__getitem__</code></p>
<p><code>__getitem__</code> is implemented to describe behavior when a program
wants to retrieve an item.It takes both <code>self</code> and <code>key</code>
as parameters.</p>
<p><code>__setitem__</code></p>
<p>Simple enough, it defines behavior for when a program tries to change an item.
It takes the parameters <code>self, key</code> and <code>value</code>, defining
where and what to set in the container.</p>
<p><code>__delitem__</code></p>
<p>Defines behavior for deleting an item. Arguments are <code>self</code> and
<code>key</code>.</p>
<p><code>__iter__</code></p>
<p>Wait, I thought there were only 4 methods to define? While that is technically
true, <code>__iter__</code> is a must if someone wants to iterate through your
container.</p>
<p><strong>Putting it all together</strong></p>
<p>Here's an extremely useless implementation of a "vocal list" that speaks out
whenever something happens to it:</p>
<div class="pygments_tango"><pre><span class="k">class</span> <span class="nc">VocalList</span><span class="p">:</span>

<pre><code>&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;values&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;It&amp;#39;s alive!!!&amp;quot;&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__len__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;I&amp;#39;ll stand still while you measure me.&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__getitem__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Would you like fries with that item?&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__setitem__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;I&amp;#39;ll change for you.&amp;quot;&lt;/span&gt;
    &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__delitem__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;I&amp;#39;m MELTING&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__iter__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Iteration in 5, 4, 3...&amp;quot;&lt;/span&gt;
    &lt;span class="c"&gt;# make self.values iterable...&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;iter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
</code></pre>
<p></pre></div></p>
<p>An example of a session with <code>VocalList</code>:</p>
<div class="pygments_tango"><pre>&gt;&gt;&gt; v = VocalList([1, 2, 3, 4])
It&#39;s alive!!!
&gt;&gt;&gt; len(v)
I&#39;ll stand still while you measure me.
4
&gt;&gt;&gt; v[1]
Would you like fries with that item?
2
&gt;&gt;&gt; v[3] = 5
I&#39;ll change for you.
&gt;&gt;&gt; del v[3]
I&#39;m MELTING
&gt;&gt;&gt; for i in v:
...     print i
... 
Iteration in 5, 4, 3...
1
2
3
4
</pre></div>

<p><strong>A better way of doing things</strong></p>
<p>Of course, the list implementation that we defined earlier is incomplete. It
lacks many of the amenities of regular Python lists, including favorite methods
<code>append</code>, <code>sort</code>, <code>index</code>, and others. But
new-style classes (which are hardly a new language feature at this point) allow
classes to subclass types.This means that by simply inheriting all the good
stuff from the builtin <code>list</code> type, we can define some custom
behavior but keep all the list methods we know and love. Example:</p>
<p>$$code(lang=python)
class ProtectiveList(list):
    """A list that won't let its items be deleted on their own."""</p>
<pre><code>def __init__(self, *args):
    # call the constructor for a list
    super(ProtectiveList, self).__init__(*args)

def __delitem__(self, key):
    print "I will NOT allow that to happen."&lt;/pre&gt;
</code></pre>
<p>Well, there you have it. The easy way (and the hard way) to define custom
container objects in Python. Until next monday.</p>

  </div>
</div>



<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://www.rafekettler.com/blog/2010/11/08/magic-method-monday-creating-custom-sequences-and-mappings";
</script>
<script type="text/javascript" src="http://disqus.com/forums/rafekettler.com/embed.js"></script>
<noscript><a href="http://rafekettler.com.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

        </div><!-- End Prose Block -->
      </div><!-- End Main Block -->
      <div id="footer">
        
  <hr/>
  <p id="credits">
Copyright &copy; Rafe Kettler, 2010-11<br/>
Powered by <a href="http://www.blogofile.com">Blogofile</a>.<br/>
RSS feeds for <a href="/blog/feed">Entries</a>
 and <a
href="http://rafekettler.com.disqus.com/latest.rss">Comments</a>.
<br>
</p>
<script type="text/javascript">
//<![CDATA[
(function() {
		var links = document.getElementsByTagName('a');
		var query = '?';
		for(var i = 0; i < links.length; i++) {
			if(links[i].href.indexOf('#disqus_thread') >= 0) {
				query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
			}
		}
		document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/rafekettler.com/get_num_replies.js' + query + '"></' + 'script>');
	})();
//]]>
</script>


      </div> <!-- End Footer -->
    </div> <!-- End Content -->
  </body>
</html>



















